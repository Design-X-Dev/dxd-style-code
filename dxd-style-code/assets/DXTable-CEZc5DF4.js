import{c as S,a as N,p as O,o as V,b as z,j as x,x as v,z as oe,r as T,w as I,C as se,d as R,e as j,O as k,U as re,G as ue,g as X,n as ie,k as ce}from"./vue.esm-bundler-C1fUoNF-.js";import{D as de}from"./DXBaseTable-DOauzPC8.js";import{_ as fe}from"./DXTableToolbar-zNIf53Pf.js";import{_ as me}from"./DXTablePagination-C1NyvhCh.js";import{_ as U}from"./DXIcon-Bc0cQL8C.js";import{_ as ve}from"./DXTags-CLVQQJAQ.js";import{r as ge}from"./FunnelIcon-Ba3wLEuE.js";import{r as pe}from"./XCircleIcon-CCzMyyl7.js";import{_ as be}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ye={key:0,class:"flex items-center justify-between gap-4 px-4 py-3 bg-slate-50 border-b border-slate-200","data-component":"DXTableFiltersPanel"},he={class:"flex items-center gap-3 flex-1 flex-wrap"},Se={class:"flex items-center gap-2 text-sm text-slate-600 font-medium"},q={__name:"DXTableFiltersPanel",props:{activeFilters:{type:Array,default:()=>[]}},emits:["remove-filter","clear-all"],setup(l,{emit:s}){const n=l,e=s,a=S(()=>n.activeFilters.map(d=>({label:`${d.columnLabel}: ${d.valueLabel}`,closable:!0,color:"primary",data:d}))),u=d=>{const c=(d==null?void 0:d.tag)||d;c!=null&&c.data&&e("remove-filter",c.data.column)},w=()=>{e("clear-all")};return(d,c)=>l.activeFilters.length>0?(V(),N("div",ye,[z("div",he,[z("div",Se,[x(U,{icon:v(ge),size:"sm",class:"text-slate-500"},null,8,["icon"]),z("span",null,"Активные фильтры ("+oe(l.activeFilters.length)+")",1)]),x(ve,{tags:a.value,variant:"default",color:"primary",onRemove:u},null,8,["tags"])]),z("button",{type:"button",onClick:w,class:"flex items-center gap-1.5 px-3 py-1.5 text-sm text-slate-600 hover:text-slate-900 hover:bg-slate-100 rounded-lg transition-colors"},[x(U,{icon:v(pe),size:"sm",class:"text-slate-500"},null,8,["icon"]),c[0]||(c[0]=z("span",null,"Очистить все",-1))])])):O("",!0)}};q.__docgenInfo={exportName:"default",displayName:"DXTableFiltersPanel",description:"",tags:{},props:[{name:"activeFilters",description:"Список активных фильтров: [{ column, columnLabel, value, valueLabel }]",type:{name:"array"},defaultValue:{func:!1,value:"[]"}}],events:[{name:"remove-filter"},{name:"clear-all"}],sourceFiles:["/Users/lea_alex/Projects/1_DEVELOP/0_DESIGN_X_DEV/dxd-style-code/src/components/molecules/DXTableFiltersPanel/DXTableFiltersPanel.vue"]};function we(l,s){const n=T([]),e=T(!1),a=T(null),u=()=>{n.value=[...l.data]},w=async(c={})=>{if(!l.apiUrl){a.value="API URL не указан";return}e.value=!0,a.value=null;try{const b=new URLSearchParams({...l.apiParams,...c}).toString(),f=`${l.apiUrl}${b?`?${b}`:""}`,o=await fetch(f,{method:l.apiMethod||"GET",headers:{"Content-Type":"application/json"}});if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);const t=await o.json();n.value=Array.isArray(t)?t:t.data||[],s("data-loaded",n.value)}catch(b){a.value=b.message,s("error",b)}finally{e.value=!1}},d=c=>l.mode==="api"?w(c):(u(),Promise.resolve());return I(()=>l.data,()=>{l.mode==="local"&&u()},{immediate:!0,deep:!0}),{localData:n,loading:e,error:a,loadData:d}}function Ce(l,s,n){var c,b;const e=T(((c=s.defaultSort)==null?void 0:c.column)||null),a=T(((b=s.defaultSort)==null?void 0:b.direction)||"asc"),u=S(()=>!e.value||!s.sortable?l.value:[...l.value].sort((o,t)=>{const m=o[e.value],D=t[e.value];if(m==null)return 1;if(D==null)return-1;if(typeof m=="number"&&typeof D=="number")return a.value==="asc"?m-D:D-m;const r=String(m).toLowerCase(),i=String(D).toLowerCase();return a.value==="asc"?r.localeCompare(i):i.localeCompare(r)}));return{sortBy:e,sortDirection:a,sortedData:u,toggleSort:f=>{e.value===f?a.value==="asc"?a.value="desc":a.value==="desc"&&(e.value=null,a.value="asc"):(e.value=f,a.value="asc"),n("sort",{column:e.value,direction:a.value})},resetSort:()=>{var f,o;e.value=((f=s.defaultSort)==null?void 0:f.column)||null,a.value=((o=s.defaultSort)==null?void 0:o.direction)||"asc"}}}function De(l,s,n,e=null){const a=T({}),u=T(""),w=e||l,d=S(()=>{let r=[...l.value];if(u.value&&s.searchable){const i=u.value.toLowerCase();r=r.filter(h=>s.columns.some(g=>{const P=h[g.key];return P!=null&&String(P).toLowerCase().includes(i)}))}return s.filterable&&Object.keys(a.value).length>0&&(r=r.filter(i=>Object.entries(a.value).every(([h,g])=>!g||g===""?!0:i[h]===g))),r}),c=(r,i)=>{i?a.value[r]=i:delete a.value[r],n("filter",{column:r,value:i,filters:{...a.value}})},b=()=>{a.value={},u.value="",n("filter-clear")},f=r=>{delete a.value[r],n("filter",{column:r,value:null,filters:{...a.value}})},o=r=>{const i=new Set;return w.value.forEach(h=>{const g=h[r];g!=null&&g!==""&&i.add(g)}),Array.from(i).sort().map(h=>({value:h,label:String(h)}))},t=r=>{if(r.filterOptions&&Array.isArray(r.filterOptions))return r.filterOptions.some(g=>g.value===""||g.value===null)?r.filterOptions:[{value:"",label:"Все"},...r.filterOptions];const i=o(r.key);return[{value:"",label:"Все"},...i]},m=S(()=>!s.filterable||Object.keys(a.value).length===0?[]:Object.entries(a.value).map(([r,i])=>{if(!i||i==="")return null;const h=s.columns.find(F=>F.key===r);if(!h)return null;const P=t(h).find(F=>F.value===i),B=P?P.label:String(i);return{column:r,columnLabel:h.label,value:i,valueLabel:B}}).filter(Boolean)),D=S(()=>m.value.length);return{filters:a,searchQuery:u,filteredData:d,applyFilter:c,clearFilters:b,clearColumnFilter:f,getFilterOptions:t,activeFilters:m,activeFiltersCount:D}}function Te(l,s,n){const e=T(1),a=T(s.defaultPageSize||10),u=S(()=>!s.paginated||l.value.length===0?1:Math.ceil(l.value.length/a.value)),w=S(()=>{if(!s.paginated)return l.value;const t=(e.value-1)*a.value,m=t+a.value;return l.value.slice(t,m)}),d=S(()=>{const t=l.value.length;if(t===0)return{from:0,to:0,total:0};const m=(e.value-1)*a.value+1,D=Math.min(e.value*a.value,t);return{from:m,to:D,total:t}}),c=t=>{t<1||t>u.value||(e.value=t,n("page-change",e.value))},b=()=>{e.value<u.value&&(e.value++,n("page-change",e.value))},f=()=>{e.value>1&&(e.value--,n("page-change",e.value))},o=t=>{a.value=t,e.value=1,n("page-size-change",a.value)};return I(()=>l.value.length,()=>{e.value>u.value&&(e.value=Math.max(1,u.value))}),{currentPage:e,pageSize:a,totalPages:u,paginatedData:w,paginationInfo:d,goToPage:c,nextPage:b,previousPage:f,changePageSize:o}}function Pe(l,s,n){const e=T([]),a=S(()=>l.value.length===0?!1:e.value.length===l.value.length),u=S(()=>e.value.length>0&&e.value.length<l.value.length);return{selectedRows:e,allSelected:a,someSelected:u,isSelected:t=>e.value.includes(t),toggleRow:t=>{const m=e.value.indexOf(t);m>-1?e.value.splice(m,1):e.value.push(t),n("row-select",{id:t,selected:m===-1,selectedRows:[...e.value]})},selectAll:()=>{a.value?(e.value=[],n("select-all",{selected:!1,selectedRows:[]})):(e.value=l.value.map(t=>t.id),n("select-all",{selected:!0,selectedRows:[...e.value]}))},clearSelection:()=>{e.value=[],n("selection-clear")},selectRows:t=>{e.value=[...t],n("selection-change",[...e.value])},getSelectedRowsData:()=>l.value.filter(t=>e.value.includes(t.id))}}function Fe(l,s){const n=T([]),e=S(()=>l.columns.filter(o=>!n.value.includes(o.key))),a=S(()=>l.columns.map(o=>({...o,visible:!n.value.includes(o.key)})));return{hiddenColumns:n,visibleColumns:e,columnsWithVisibility:a,toggleColumn:o=>{const t=n.value.indexOf(o);t>-1?n.value.splice(t,1):n.value.push(o),s("column-toggle",{column:o,visible:t>-1,hiddenColumns:[...n.value]})},showColumn:o=>{const t=n.value.indexOf(o);t>-1&&(n.value.splice(t,1),s("column-show",o))},hideColumn:o=>{n.value.includes(o)||(n.value.push(o),s("column-hide",o))},showAllColumns:()=>{n.value=[],s("columns-show-all")},hideAllColumns:(o=[])=>{n.value=l.columns.filter(t=>!o.includes(t.key)).map(t=>t.key),s("columns-hide-all")},resetColumns:()=>{n.value=[],s("columns-reset")}}}const ze={class:"dx-table-wrapper","data-component":"DXTable"},G={__name:"DXTable",props:{columns:{type:Array,required:!0},data:{type:Array,default:()=>[]},mode:{type:String,default:"local",validator:l=>["local","api"].includes(l)},apiUrl:{type:String},apiMethod:{type:String,default:"GET"},apiParams:{type:Object,default:()=>({})},searchable:{type:Boolean,default:!1},filterable:{type:Boolean,default:!1},sortable:{type:Boolean,default:!0},paginated:{type:Boolean,default:!0},selectable:{type:Boolean,default:!1},groupBy:{type:String},size:{type:String,default:"md",validator:l=>["sm","md","lg"].includes(l)},height:{type:String},stickyHeader:{type:Boolean,default:!0},striped:{type:Boolean,default:!1},bordered:{type:Boolean,default:!1},hoverable:{type:Boolean,default:!0},dense:{type:Boolean,default:!1},showToolbar:{type:Boolean,default:!0},columnToggle:{type:Boolean,default:!1},actions:{type:Boolean,default:!1},defaultPageSize:{type:Number,default:10},pageSizeOptions:{type:Array,default:()=>[10,25,50,100]},defaultSort:{type:Object},loading:{type:Boolean,default:!1}},emits:["row-click","row-select","select-all","sort","filter","filter-clear","page-change","page-size-change","edit","delete","data-loaded","error","column-toggle","selection-clear"],setup(l,{emit:s}){const n=se(),e=l,a=s,{localData:u}=we(e,a),{sortBy:w,sortDirection:d,sortedData:c,toggleSort:b}=Ce(u,e,a),{searchQuery:f,filters:o,filteredData:t,applyFilter:m,getFilterOptions:D,activeFilters:r,clearFilters:i,clearColumnFilter:h}=De(c,e,a,u),{currentPage:g,pageSize:P,totalPages:B,paginatedData:F,paginationInfo:A}=Te(t,e,a),{selectedRows:$,toggleRow:H,selectAll:M}=Pe(t,e,a),{visibleColumns:Q,columnsWithVisibility:W,toggleColumn:J}=Fe(e,a),Y=S(()=>e.searchable||e.columnToggle||!!n["toolbar-actions"]),L=S(()=>e.groupBy?t.value:F.value),Z=p=>D(p),K=({column:p,value:y})=>{m(p,y)},_=p=>{h(p)},ee=()=>{i()},le=({column:p,direction:y})=>{b(p)},ae=({id:p,selected:y})=>{H(p)},te=p=>{M()};return(p,y)=>(V(),N("div",ze,[l.showToolbar&&Y.value?(V(),R(fe,{key:0,searchQuery:v(f),"onUpdate:searchQuery":y[0]||(y[0]=C=>k(f)?f.value=C:null),size:l.size,searchable:l.searchable,selectedCount:v($).length,columnToggle:l.columnToggle,columns:v(W),onToggleColumn:v(J)},{right:j(()=>[X(p.$slots,"toolbar-actions",{},void 0,!0)]),_:3},8,["searchQuery","size","searchable","selectedCount","columnToggle","columns","onToggleColumn"])):O("",!0),l.filterable?(V(),R(q,{key:1,activeFilters:v(r),onRemoveFilter:_,onClearAll:ee},null,8,["activeFilters"])):O("",!0),x(de,{columns:v(Q),data:L.value,sortBy:v(w),sortDirection:v(d),selectedRows:v($),selectable:l.selectable,actions:l.actions,filterable:l.filterable,filters:v(o),getFilterOptions:Z,groupBy:l.groupBy,height:l.height,stickyHeader:l.stickyHeader,striped:l.striped,bordered:l.bordered,hoverable:l.hoverable,dense:l.dense,size:l.size,loading:l.loading,onSort:le,onFilter:K,onRowClick:y[1]||(y[1]=C=>p.$emit("row-click",C)),onRowSelect:ae,onSelectAll:te,onEdit:y[2]||(y[2]=C=>p.$emit("edit",C)),onDelete:y[3]||(y[3]=C=>p.$emit("delete",C))},re({_:2},[ue(p.$slots,(C,E)=>({name:E,fn:j(ne=>[X(p.$slots,E,ie(ce(ne||{})),void 0,!0)])}))]),1032,["columns","data","sortBy","sortDirection","selectedRows","selectable","actions","filterable","filters","groupBy","height","stickyHeader","striped","bordered","hoverable","dense","size","loading"]),l.paginated&&!l.loading&&L.value.length>0?(V(),R(me,{key:2,currentPage:v(g),"onUpdate:currentPage":y[4]||(y[4]=C=>k(g)?g.value=C:null),pageSize:v(P),"onUpdate:pageSize":y[5]||(y[5]=C=>k(P)?P.value=C:null),size:l.size,totalPages:v(B),pageSizeOptions:l.pageSizeOptions,from:v(A).from,to:v(A).to,total:v(A).total},null,8,["currentPage","pageSize","size","totalPages","pageSizeOptions","from","to","total"])):O("",!0)]))}},Ee=be(G,[["__scopeId","data-v-1bc47a92"]]);G.__docgenInfo={exportName:"default",displayName:"DXTable",description:"",tags:{},props:[{name:"columns",type:{name:"array"},required:!0},{name:"data",type:{name:"array"},defaultValue:{func:!1,value:"[]"}},{name:"mode",type:{name:"string"},defaultValue:{func:!1,value:"'local'"},values:["local","api"]},{name:"apiUrl",type:{name:"string"}},{name:"apiMethod",type:{name:"string"},defaultValue:{func:!1,value:"'GET'"}},{name:"apiParams",type:{name:"object"},defaultValue:{func:!1,value:"{}"}},{name:"searchable",type:{name:"boolean"},defaultValue:{func:!1,value:"false"}},{name:"filterable",type:{name:"boolean"},defaultValue:{func:!1,value:"false"}},{name:"sortable",type:{name:"boolean"},defaultValue:{func:!1,value:"true"}},{name:"paginated",type:{name:"boolean"},defaultValue:{func:!1,value:"true"}},{name:"selectable",type:{name:"boolean"},defaultValue:{func:!1,value:"false"}},{name:"groupBy",type:{name:"string"}},{name:"size",type:{name:"string"},defaultValue:{func:!1,value:"'md'"},values:["sm","md","lg"]},{name:"height",type:{name:"string"}},{name:"stickyHeader",type:{name:"boolean"},defaultValue:{func:!1,value:"true"}},{name:"striped",type:{name:"boolean"},defaultValue:{func:!1,value:"false"}},{name:"bordered",type:{name:"boolean"},defaultValue:{func:!1,value:"false"}},{name:"hoverable",type:{name:"boolean"},defaultValue:{func:!1,value:"true"}},{name:"dense",type:{name:"boolean"},defaultValue:{func:!1,value:"false"}},{name:"showToolbar",type:{name:"boolean"},defaultValue:{func:!1,value:"true"}},{name:"columnToggle",type:{name:"boolean"},defaultValue:{func:!1,value:"false"}},{name:"actions",type:{name:"boolean"},defaultValue:{func:!1,value:"false"}},{name:"defaultPageSize",type:{name:"number"},defaultValue:{func:!1,value:"10"}},{name:"pageSizeOptions",type:{name:"array"},defaultValue:{func:!1,value:"[10, 25, 50, 100]"}},{name:"defaultSort",type:{name:"object"}},{name:"loading",type:{name:"boolean"},defaultValue:{func:!1,value:"false"}}],events:[{name:"row-click"},{name:"edit"},{name:"delete"},{name:"row-select"},{name:"select-all"},{name:"sort"},{name:"filter"},{name:"filter-clear"},{name:"page-change"},{name:"page-size-change"},{name:"data-loaded"},{name:"error"},{name:"column-toggle"},{name:"selection-clear"}],slots:[{name:"toolbar-actions"},{name:"slot",scoped:!0,bindings:[{name:"name",title:"binding"}]}],sourceFiles:["/Users/lea_alex/Projects/1_DEVELOP/0_DESIGN_X_DEV/dxd-style-code/src/components/organisms/DXTable/DXTable.vue"]};export{Ee as D};
